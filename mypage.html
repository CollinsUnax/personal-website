<html>
<body>
	<div id="title">
		<h1>Welcome to John's website</h1>
		<p>This is where dreams come true</p>
		<button onclick="makeDreamComeTrue()">Make dream come true</button>
    </div>
    <div class="section craps-section">
        <div class="section-title">
            Craps Game
        </div>
        <div id="craps-registration-pane">
            <div class="section-subtitle">
                Enter username to begin
            </div>
            <div>
                <input id="craps-username">
            </div>
            <div>
                <button onclick="registerCrapsPlayer()">Continue</button>
            </div>
        </div>
        <div id="craps-main-pane">
            <div>
                User: <span id="craps-username-greeting"></span>
            </div>
            <div class="craps-user-stats">
                <div>
                    Money Available: <span id="craps-user-money">1000</span>$
                </div>
                <div>
                    Rounds Lasted: <span id="craps-user-rounds">0</span>
                </div>
            </div>
            <div class="craps-bet-setup">
                <div>
                    <div>
                        Bet:
                    </div>
                    <div id="craps-bet-pass" class="craps-bet-option" onclick="selectBet('PASS')">
                        PASS
                    </div>
                    <div id="craps-bet-no-pass" class="craps-bet-option" onclick="selectBet('NO PASS')">
                        NO PASS
                    </div>
                </div>
                <div>
                    Bet Amount: 100$
                </div>
            </div>
            <div class="craps-dice-info">
                <div>
                    Dice 1: <span id="dice-roll-1"></span>
                </div>
                <div>
                    Dice 2: <span id="dice-roll-2"></span>
                </div>
                <div>
                    <span id="dice-roll-result"></span>
                </div>
            </div>
            <div class="craps-bet-outcome">
                <div>
                    <span id="craps-result-description"></span>
                </div>
                <div id="craps-action-roll">
                    <button onclick="startDiceRoll()">ROLL</button>
                </div>
                <div id="craps-action-continue-exit">
                    <button onclick="setupRound()">NEXT ROUND</button>
                    <button onclick="endGame()">EXIT</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<style>

body {
	background-image: url("https://iso.500px.com/wp-content/uploads/2014/07/big-one.jpg");
	background-size: cover;
}

body, html {
    margin: 0;
    padding: 0;
}

h1 {
	color: blue;
}

button:hover {
	background-color: red;
	cursor: pointer;
	font-size: 20px;
}

#title {
	width: 100%;
	text-align: center;
	margin-top: 50px;
}

.section {
    width: 100%;
    border: solid white 1px;
    padding: 25px;
    box-sizing: border-box;
}

.section-title {
    font-size: 25px;
    color: white;
    margin-bottom: 15px;
}

.craps-section {
    color: white;
}

#craps-main-pane {
    display: none;
}

.craps-bet-option {
    border: solid white 1px;
    border-radius: 5px;
    width: 100px;
    text-align: center;
    padding: 10px;
    display: inline-block;
}

.craps-bet-option:hover {
    cursor: pointer;
    background-color: red !important;
}

#craps-action-continue-exit {
    display: none;
}

</style>

<script>

function makeDreamComeTrue () {
	document.body.style.background = 'url("https://media.giphy.com/media/HhTXt43pk1I1W/200.gif")'
	document.getElementById('title').style.display = 'none'
}

//////////////////////////////////////////////////
//
//                 Craps Section
//
//////////////////////////////////////////////////

let moneyAvailable = 1000
let defaultBetAmount = 100
let roundsLasted = 0
let selectedBet = 'PASS'
let roundIsOver = true

function registerCrapsPlayer () {
    let crapsUsername = document.getElementById('craps-username').value

    let invalidCharacterPattern = /^[0-9]|[^a-zA-Z0-9_]/g
    let usernameIsInvalid = crapsUsername.length < 5

    if (usernameIsInvalid || invalidCharacterPattern.test(crapsUsername)) {
        crapsUsername = "User123"
        alert("Username must be at least 5 characters long, alphanumeric and underscore only, no spaces, and cannot start with a number! Assigning default username: " + crapsUsername)
    }
    document.getElementById('craps-username').value = ''

    document.getElementById('craps-username-greeting').innerHTML = crapsUsername
    document.getElementById('craps-registration-pane').style.display = 'none'
    document.getElementById('craps-main-pane').style.display = 'block'

    setupRound()
}

function setupRound () {
    document.getElementById('dice-roll-1').innerHTML = '-'
    document.getElementById('dice-roll-2').innerHTML = '-'
    document.getElementById('dice-roll-result').innerHTML = 'WAITING TO ROLL'

    roundIsOver = true
    selectBet(selectedBet)

    // Close actions and open roll
    document.getElementById('craps-action-continue-exit').style.display = 'none'
    document.getElementById('craps-action-roll').style.display = 'block'
}

function selectBet (bet) {
    if (roundIsOver) {
        selectedBet = bet
        if (bet === 'PASS') {
            document.getElementById('craps-bet-pass').style.backgroundColor = 'red'
            document.getElementById('craps-bet-no-pass').style.backgroundColor = 'transparent'
            document.getElementById('craps-result-description').innerHTML = 'Bet PASS - Need a 7 or 11 to win!'
        } else if (bet === 'NO PASS') {
            document.getElementById('craps-bet-no-pass').style.backgroundColor = 'red'
            document.getElementById('craps-bet-pass').style.backgroundColor = 'transparent'
            document.getElementById('craps-result-description').innerHTML = 'Bet NO PASS - Need a 2, 3 or 12 to win!'
        }
    }
}

function startDiceRoll () {
    roundIsOver = false
    document.getElementById('dice-roll-1').innerHTML = '...'
    document.getElementById('dice-roll-2').innerHTML = '...'
    document.getElementById('dice-roll-result').innerHTML = 'ROLLING...'
    document.getElementById('craps-action-roll').style.display = 'none'

    // TODO: Add small delay before calling function
    setTimeout(function(){ endDiceRoll() }, 850)
}

function endDiceRoll () {
    let diceResult1 = getDiceResult()
    let diceResult2 = getDiceResult()
    document.getElementById('dice-roll-1').innerHTML = diceResult1
    document.getElementById('dice-roll-2').innerHTML = diceResult2

    let diceResultSum = diceResult1 + diceResult2
    let diceResultName
    if (diceResultSum === 7 || diceResultSum === 11) {
        diceResultName = 'PASS'
    } else if (diceResultSum === 2 || diceResultSum === 3 || diceResultSum === 12) {
        diceResultName = 'NO PASS'
    } else {
        diceResultName = 'POINT SCORE'
    }
    document.getElementById('dice-roll-result').innerHTML = 'Sum: ' + diceResultSum + ', Result: ' + diceResultName

    if (diceResultName === 'POINT SCORE') {
        document.getElementById('craps-result-description').innerHTML = 'NO WINNER FOR NOW'
    } else {
        if (selectedBet === diceResultName) {
            document.getElementById('craps-result-description').innerHTML = 'YOU WIN!'
            moneyAvailable += defaultBetAmount
        } else {
            document.getElementById('craps-result-description').innerHTML = 'YOU LOSE :('
            moneyAvailable -= defaultBetAmount
        }
    }
    roundsLasted += 1
    document.getElementById('craps-user-money').innerHTML = moneyAvailable
    document.getElementById('craps-user-rounds').innerHTML = roundsLasted
    document.getElementById('craps-action-continue-exit').style.display = 'block'
}

function getDiceResult () {
    return Math.floor(Math.random() * 6) + 1
}

function endGame () {
    alert('After lasting ' + roundsLasted + ' rounds, you have left with ' + moneyAvailable + '$ dollars!')
    document.getElementById('craps-main-pane').style.display = 'none'
    document.getElementById('craps-registration-pane').style.display = 'block'
    roundIsOver = true

    // Reset money and rounds
    moneyAvailable = 1000
    roundsLasted = 0
    document.getElementById('craps-user-money').innerHTML = moneyAvailable
    document.getElementById('craps-user-rounds').innerHTML = roundsLasted
}

//////////////////////////////////////////////////
//
//                End Craps Section
//
//////////////////////////////////////////////////

</script>
